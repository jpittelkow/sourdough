---
description: Ensure proper logging when creating features that access or modify data
alwaysApply: true
---

# Logging Compliance

Ensure proper logging is added when creating features that access or modify data.

## Access Logging (HIPAA)

When creating features that access user data (PHI), add access logging:

1. **Route-level:** Apply `log.access` middleware to routes accessing user data.
2. **Manual:** Use `AccessLogService::log()` for custom access tracking.

Routes that **MUST** have access logging:

- Any endpoint returning user profile data
- Any endpoint modifying user data
- Any endpoint listing users
- Any endpoint exporting user data
- Any endpoint accessing user settings

## Application Logging

When creating services that perform significant operations, add logging:

1. Use `Log::info()` for successful operations (backup created, email sent).
2. Use `Log::warning()` for recoverable failures (provider failed, retry succeeded).
3. Use `Log::error()` for failures (send failed, backup failed).

Always include structured context:

```php
Log::info('Operation completed', ['user_id' => $id, 'duration_ms' => $ms]);
```

## Audit Logging

For user-initiated actions that should appear in the audit log:

- Use `AuditService::log()` or the `AuditLogging` trait.
- Required for: auth events, settings changes, admin actions.

## Frontend Error Logging

Replace `console.error` / `console.warn` with `errorLogger`:

- `errorLogger.report(error, context)` for errors
- `errorLogger.captureMessage(message, level, context)` for warnings/info

## Quick Checklist

Before completing a feature, verify:

- [ ] User data access routes have `log.access` middleware
- [ ] Service operations have appropriate `Log::info` / `Log::warning` / `Log::error` calls
- [ ] User actions have audit logging via `AuditService`
- [ ] Frontend errors use `errorLogger`, not `console.error`

## Related

- [Recipe: Add access logging](docs/ai/recipes/add-access-logging.md)
- [Recipe: Extend logging](docs/ai/recipes/extend-logging.md)
- [Patterns: AccessLogService](docs/ai/patterns.md#accesslogservice-pattern-hipaa-access-logging)
- [Logging standards](docs/logging.md)
