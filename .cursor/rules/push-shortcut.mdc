---
description: When user says "push" - commit, version bump, tag, and push to trigger release
globs: []
---

# Push Shortcut

When the user says **"push"** (with or without additional context), perform a full commit-and-release cycle.

## Interpretation

| User says | Version bump | Notes |
|-----------|-------------|-------|
| "push" | `patch` | Default — most common |
| "push minor" | `minor` | New feature set |
| "push major" | `major` | Breaking change |
| "push 1.2.3" | exact `1.2.3` | Explicit version |

If the user provides a commit message (e.g., "push — added new feature"), use it. Otherwise, analyze the staged/unstaged changes and write an appropriate conventional-commits-style message.

## Steps (execute in order)

1. **Pre-flight checks**
   - Run `git status` and `git diff --stat` to understand what will be committed
   - Scan for debug code (`dd(`, `dump(`, `console.log`, `debugger`) — abort and warn if found
   - Scan for secrets/credentials — abort and warn if found
   - Read `VERSION` to get the current version

2. **Stage and commit**
   - `git add -A`
   - Write commit message to `.git/COMMIT_MSG` using the Write tool (PowerShell does NOT support heredoc)
   - `git commit -F .git/COMMIT_MSG`

3. **Bump version locally** (cleaner git history)
   - Calculate the new version from the current `VERSION` + bump type
   - Update `VERSION` and `frontend/package.json`
   - `git add VERSION frontend/package.json`
   - `git commit -m "Release vX.Y.Z"`

4. **Tag and push**
   - `git tag vX.Y.Z`
   - `git push origin <branch> vX.Y.Z` (commit + tag in same push to avoid race conditions)
   - If push is rejected (remote ahead), fetch and rebase:
     - `git fetch origin`
     - `git pull --rebase origin <branch>`
     - Set `$env:GIT_EDITOR = "true"` if rebase needs continue (PowerShell terminals are "dumb")
     - Then push again

5. **Verify**
   - Run `gh run list --limit 3` to confirm the release workflow was triggered
   - Report the new version and workflow status to the user

## Critical Rules

- **PowerShell environment** — Never use bash heredoc (`<<'EOF'`). Always write commit messages to `.git/COMMIT_MSG` with the Write tool, then `git commit -F .git/COMMIT_MSG`.
- **Push commit + tag together** — Always use `git push origin <branch> vX.Y.Z` to avoid race conditions where the tag arrives before the commit.
- **Never skip hooks** — Do not use `--no-verify`.
- **Never force push** — Unless the user explicitly asks.

## Reference

- Full release recipe: [docs/ai/recipes/commit-and-release.md](../../docs/ai/recipes/commit-and-release.md)
- Release workflow: [.github/workflows/release.yml](../../.github/workflows/release.yml)
- Version bump script: [scripts/bump-version.sh](../../scripts/bump-version.sh)
- PowerShell release script: [scripts/push.ps1](../../scripts/push.ps1)
